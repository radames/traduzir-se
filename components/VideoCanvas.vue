<template>
  <div>
    <canvas ref="mycanvas"></canvas>
  </div>
</template>
<script>
export default {
  props: {
    poemsData: {
      type: Array,
      required: true
    },
    selectedData: {
      type: Object,
      required: true
    }
  },
  data() {
    return {
      pixiApp: null,
      textures: [],
      sprites: [],
      videosEl: []
    }
  },
  computed: {
    // selected verse index
    selectedVerseId() {
      return this.selectedData.selectedVerse
    },
    // filtered selected language data

    selectedLangData() {
      if (this.poemsData) {
        return this.poemsData.find(
          (e) => e.langs === this.selectedData.selectedLang
        )
      }
      return null
    },
    // filter  all others languages not selected, for random overlays
    unselectedLangData() {
      if (this.poemsData) {
        return this.poemsData
          .filter((e) => e.langs !== this.selectedData.selectedLang)
          .sort(() => Math.random() - 0.5)
      }
      return null
    }
  },
  watch: {
    'selectedData.selectedVerse'() {
      if (this.selectedVerseId > -1) {
        const videos = this.selectedLangData.verses[this.selectedVerseId].videos

        this.videosEl[0].src = videos[~~(Math.random() * videos.length)].urlLang
        this.videosEl[0].play()
        for (let i = 0; i < 2; i++) {
          const versesLayers = this.unselectedLangData[i].verses
          const videosLayers = versesLayers[this.selectedVerseId].videos
          this.videosEl[i + 1].src =
            videosLayers[~~(Math.random() * videosLayers.length)].urlLang
          this.videosEl[i + 1].play()
        }
      }
    }
  },
  mounted() {
    this.pixiApp = new this.$PIXI.Application({
      view: this.$refs.mycanvas,
      antialias: true, // default: false
      transparent: true, // default: false
      resolution: 1 // default: 1)
    })
    this.pixiApp.view.style.width = '100%'
    this.pixiApp.view.style.height = 'auto'
    for (let i = 0; i < 3; i++) {
      const videoEl = document.createElement('video')
      videoEl.loop = true
      videoEl.volume = 0
      videoEl.crossOrigin = 'anonymous'
      videoEl.src =
        'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAB8FtZGF0AAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE1NSByMjkwMSA3ZDBmZjIyIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxOCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTIgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTI0IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAMmWIhAA7//73Tr8Cm2MR+oDklcK9sqkJln90o4dnpKoJw5taqLoAAD4CWcAQRILoKOCnAAAAC0GaJGxDv/6plgQc3gIATGF2YzU4LjE4LjEwMABCIAjBGDgAAAAIQZ5CeIX/AbUhEARgjBwhEARgjBwAAAAIAZ5hdEK/Ak4hEARgjBwhEARgjBwAAAAIAZ5jakK/Ak8hEARgjBwhEARg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'
      const texture = this.$PIXI.Texture.from(videoEl)
      const sprite = new this.$PIXI.Sprite(texture)
      sprite.height = this.pixiApp.screen.height

      if (i > 0) sprite.blendMode = this.$PIXI.BLEND_MODES.MULTIPLY
      this.sprites.push(sprite)
      this.videosEl.push(videoEl)
      this.textures.push(texture)
      this.pixiApp.stage.addChild(sprite)
    }
  }
}
</script>
<style lang="scss" scoped></style>
